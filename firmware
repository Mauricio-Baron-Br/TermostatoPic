//Conexao com modulo SPI via Software
sbit SoftSpi_SDI at RA1_bit;
sbit SoftSpi_SDO at RA2_bit;
sbit SoftSpi_CLK at RA0_bit;

sbit SoftSpi_SDI_Direction at TRISA1_bit;
sbit SoftSpi_SDO_Direction at TRISA2_bit;
sbit SoftSpi_CLK_Direction at TRISA0_bit;

//Definição dos pinos CS - Chip Select
#define EN_7SEG1 PORTB.F0
#define EN_7SEG2 PORTB.F1

//Prototipo de funçoes exetrenas
extern unsigned short BCD_Data(unsigned short DATA );
extern int DHT11(unsigned short type);
extern void DHT11_init();

//Prototipo de funçoes
void setup();


void setup(){
     CMCON = 0x07; // Desativa comparadores
     
     TRISB.F0 = 0; //Configura RB0 como saida
     TRISB.F1 = 0; //Configura RB0 como saida
     Soft_SPI_Init(); //Inicia Software SPI
     TRISB.F4 = 0; //Configura RB0 como saida
     DHT11_init();    //Inicia DHT11
     
}
void main(){
     unsigned short dig1,dig2;
     int temp, hum;
     
     setup();

     while(1){
     //Temperatura passando o vaolr 1 retorna a umidade e passado o valor 2 reotrna a temaperatura
              temp = DHT11(2);

     //separa digitos
              temp = temp/100;
              dig2 = temp/10;
              dig1  = temp%10;

              
              dig2 = BCD_Data(dig2);//converte para BCD
              dig1 = BCD_Data(dig1);//converte para BCD
              
              //envia digito 1
              EN_7SEG1 = 0;//ChipSelect do 74hc595 responsavel pelo BCD do digito 1
              Soft_SPI_Write(dig1);  //envia dados via SPI
              EN_7SEG1 = 1;
              
              //envia digito 2
              EN_7SEG2 = 0;//ChipSelect do 74hc595 responsavel pelo BCD do digito 2
              Soft_SPI_Write(dig2);  //envia dados via SPI
              EN_7SEG2 = 1;
              
              delay_ms(500);
     }

}
